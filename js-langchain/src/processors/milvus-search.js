const { MilvusClient, DataType } = require('@zilliz/milvus2-sdk-node');
const { ClientSecretCredential, getBearerTokenProvider } = require('@azure/identity');
const { AzureOpenAIEmbeddings } = require('@langchain/openai');

const address = 'localhost:19530';
const collection_name = 'test_indra';

async function initConnection() {
  const client = new MilvusClient({ address });
  await client.connectPromise;

  return client;
}

async function search(client, searchVector) {
  console.log('+++++++++++++++ search');
  await client.loadCollection({collection_name});

  const params = {
    'collection_name': 'test_indra',
    'output_fields': [
      'id',
      'event'
    ],
    'limit': 1,
    'data': [
      {
        'anns_field': 'vector',
        'data': searchVector,
        'params': {
          'nprobe': 10
        }
      }
    ],
    'filter': '',
    'consistency_level': 'Strong'
  };

  const res = await client.search(params);

  console.log(res);
}

async function performHardcodedSearch(client) {
  const queryVector = [
    0.012195065, -0.0054255016, -0.00157804, 0.0033654296, -0.037718143,
    -0.0026300666, -0.027204916, -0.010717302, -0.006618268, -0.0067765997,
    0.05677425, -0.0055240192, -0.009239538, -0.017085757, 0.007874367,
    0.019787952, 0.01225136, -0.015565772, 0.009506943, 0.0063086413,
    -0.009978419, -0.01649465, -0.013890973, 0.02468568, -0.012539876,
    -0.009246575, 0.018070932, -0.01257506, -0.008402139, -0.011800994,
    -0.004429771, -0.015227997, -0.025234565, -0.022039782, -0.04056108,
    -0.0040181084, 0.01257506, -0.048949145, 0.024727903, -0.014735409,
    0.010520266, 0.016086508, 0.0023749764, -0.023939762, -0.020308688,
    -0.004764027, -0.02142053, -0.024741977, 0.0139120845, 0.0034463548,
    0.0037084818, -0.0044403262, -0.04343216, -0.009858791, 0.014158378,
    0.003733111, -0.012054325, 0.015030962, 0.012983205, -0.0032633936,
    0.0116532175, -0.0050806906, -0.010555451, -0.012546913, -0.002779602,
    -0.020294614, 0.010499155, 0.0117446985, -0.005675314, 0.005341058,
    0.023264214, 0.04514918, -0.0052495776, -0.034452993, 0.01598799,
    -0.0108791515, -0.01835241, -0.008697691, 0.018971663, 0.011329518,
    0.028302683, -0.01257506, -0.022264965, 0.040870707, 0.034481138,
    -0.00670623, 0.009619534, 0.01774723, -0.014482079, -0.0052249483,
    0.021124976, 0.018197598, 0.0060447548, 0.01856352, 0.011758773,
    0.019928692, -0.016227247, 0.028753048, 0.00055284175, -0.03473447,
    0.0013607736, 0.00007410806, -0.014538375, -0.013722086, -0.039012946,
    -0.026261961, -0.005745684, 0.019689435, 0.011463219, 0.009338056,
    -0.037718143, 0.027036028, -0.01670576, -0.00042595642, 0.004496622,
    0.016213173, 0.022982735, -0.0019738693, -0.0055029085, -0.03172265,
    0.024741977, 0.008205104, 0.025656782, -0.019070182, 0.028851565,
    0.019267216, -0.026529366, -0.048301745, 0.018183524, -0.01605836,
    0.014496152, 0.020322762, -0.010843966, -0.013806529, 0.0007736266,
    0.025586413,
    -0.010020642,
    0.01192766,
    -0.0060482733,
    -0.0052917995,
    0.015945768,
    0.037577406,
    -0.021702006,
    0.024066428,
    -0.018859072,
    0.011540626,
    -0.001236747,
    0.00044134978,
    0.0017258162,
    -0.012455432,
    0.011055076,
    0.018239819,
    0.008465472,
    0.008303622,
    -0.00094383326,
    0.0095773125,
    -0.011245074,
    0.027880464,
    0.0026758069,
    -0.01849315,
    -0.012145805,
    0.018859072,
    -0.004598658,
    -0.0078110336,
    0.0054325387,
    0.021814598,
    0.030061925,
    -0.022335334,
    -0.016832426,
    -0.009260649,
    -0.0051123565,
    0.0036310751,
    0.0010704986,
    0.0043382905,
    0.0028464533,
    0.031891536,
    0.01874648,
    -0.02042128,
    0.0015094295,
    -0.025839744,
    -0.021026459,
    0.027669355,
    0.016747981,
    0.017437605,
    -0.002814787,
    -0.008549916,
    0.012990242,
    -0.015425032,
    -0.0012710522,
    0.0033513557,
    0.009570275,
    0.017465753,
    -0.013468755,
    0.0039618127,
    -0.62015384,
    -0.021983486,
    0.02339088,
    -0.01691687,
    -0.0035079282,
    0.013236536,
    -0.0009798977,
    0.010203603,
    -0.018042784,
    0.015073184,
    -0.025910113,
    0.038196657,
    0.008789172,
    -0.002299329,
    0.0036979264,
    -0.0025878446,
    -0.0060201255,
    0.0107032275,
    0.0063790106,
    -0.0072128912,
    -0.0045881025,
    0.021589415,
    -0.0073043723,
    0.023953836,
    0.0019984988,
    -0.005418465,
    0.0046373615,
    0.009331019,
    -0.0047851377,
    -0.010238787,
    0.010463971,
    0.020716831,
    0.01584725,
    -0.0078110336,
    0.02450272,
    0.014580596,
    -0.013595421,
    0.022405704,
    0.0006144152,
    0.02735973,
    -0.017761305,
    -0.017719084,
    0.017465753,
    -0.016536873,
    -0.022110151,
    0.026487146,
    0.015101332,
    -0.0012006826,
    -0.0073677045,
    -0.029414523,
    0.020829422,
    0.010485081,
    0.014566522,
    0.0098376805,
    0.020913867,
    -0.008141771,
    0.041321073,
    0.003273949,
    0.008500656,
    0.010520266,
    -0.0031384875,
    0.02726121,
    -0.014538375,
    0.001280728,
    -0.015073184,
    -0.021012384,
    -0.00071337254,
    -0.009408426,
    0.005253096,
    -0.0010634616,
    0.030455993,
    0.012800244,
    0.009338056,
    -0.006766044,
    0.0045881025,
    0.018760554,
    -0.010238787,
    -0.003877369,
    -0.0012499413,
    0.0028271016,
    -0.009288797,
    -0.0081065865,
    -0.0087117655,
    0.0022834959,
    -0.009253612,
    0.023053104,
    -0.010020642,
    0.007923625,
    0.010562488,
    -0.018085007,
    0.023742728,
    0.0019158144,
    -0.007395853,
    -0.02636048,
    0.010076937,
    0.024995308,
    -0.017367234,
    -0.0068047475,
    -0.005914571,
    -0.0036979264,
    -0.000851473,
    0.0011250351,
    0.00027224267,
    -0.016860574,
    0.07025708,
    -0.00038901233,
    0.0009016114,
    0.005122912,
    0.026276035,
    -0.021730155,
    0.0016492892,
    0.021026459,
    -0.0009957309,
    -0.021476824,
    -0.012180991,
    -0.029470818,
    0.019590916,
    0.025896039,
    0.008901764,
    -0.017916119,
    0.025670856,
    -0.01176581,
    0.0100980485,
    -0.02257459,
    -0.008409176,
    0.023827171,
    0.025628636,
    -0.01459467,
    0.023193844,
    -0.013750234,
    0.00038813273,
    -0.001698548,
    0.0028499716,
    0.0003652626,
    0.020829422,
    -0.00659012,
    0.013630605,
    -0.002153312,
    0.01591762,
    -0.0106187835,
    -0.02396791,
    -0.0035220021,
    -0.0021638675,
    -0.021209419,
    -0.042165507,
    -0.03301745,
    -0.032313753,
    0.0045282883,
    -0.0016132247,
    -0.0068680802,
    -0.003055803,
    0.0008884171,
    -0.011167667,
    0.01870426,
    -0.0048027304,
    -0.0011681366,
    -0.024995308,
    -0.033580408,
    0.025375305,
    0.008768061,
    -0.0076069618,
    0.032285605,
    -0.0024418277,
    0.00874695,
    -0.028964158,
    -0.0013414219,
    -0.029301932,
    0.025670856,
    -0.011618033,
    -0.018549446,
    -0.015706511,
    -0.019759804,
    -0.02142053,
    -0.009626571,
    0.0051756892,
    0.02403828,
    -0.02726121,
    -0.008226215,
    -0.011076187,
    -0.006336789,
    -0.003951257,
    0.041433662,
    -0.025473822,
    0.028907862,
    0.010076937,
    0.0013220703,
    0.005928645,
    0.022546444,
    -0.011125445,
    0.019056108,
    -0.024784198,
    0.010344342,
    0.010196566,
    0.038759615,
    -0.002911545,
    0.012406173,
    0.015354662,
    -0.014249858,
    0.0012921632,
    0.026036778,
    0.030962655,
    0.01573466,
    0.009682867,
    0.018535372,
    -0.008261399,
    -0.028584162,
    -0.003099784,
    -0.018943517,
    0.015143554,
    0.0018542409,
    0.021012384,
    -0.0032422827,
    0.007255113,
    -0.016818352,
    -0.026599737,
    -0.00020912987,
    0.015270219,
    0.00025047205,
    -0.00928176,
    -0.0023837727,
    0.017099831,
    -0.01505911,
    0.02793676,
    0.0014346617,
    -0.02471383,
    -0.006600675,
    0.025220491,
    0.01617095,
    0.019478325,
    -0.0012851262,
    -0.0015094295,
    0.016142802,
    0.017592419,
    0.0055486485,
    0.029217489,
    0.0032774676,
    -0.0017741953,
    -0.00308571,
    0.02700788,
    -0.0079306625,
    0.00037493842,
    -0.0064036404,
    0.029667854,
    0.00089721335,
    -0.0023257176,
    0.016213173,
    0.026416775,
    0.004633843,
    -0.0070404857,
    0.015312441,
    -0.0014812816,
    -0.013053575,
    0.0067167855,
    -0.0073043723,
    0.0137361605,
    -0.017268717,
    -0.012307656,
    0.024052354,
    0.00088665786,
    0.0059779035,
    0.029498966,
    0.003557187,
    0.019056108,
    0.000053766827,
    0.01842278,
    0.0036416305,
    -0.029104896,
    -0.023039032,
    -0.0016422522,
    -0.009528054,
    -0.009767311,
    0.008592137,
    -0.01631169,
    -0.012188028,
    0.011969881,
    0.00093151856,
    0.016142802,
    0.00795881,
    0.023193844,
    0.03543817,
    -0.02489679,
    -0.004982173,
    0.046415836,
    0.02325014,
    -0.006139754,
    0.0038069992,
    -0.008254362,
    0.02218052,
    -0.027852317,
    0.019830173,
    0.023067178,
    0.042869207,
    -0.029808594,
    -0.010794708,
    -0.01552355,
    0.00589346,
    0.020899793,
    0.004887174,
    -0.017226497,
    -0.0014812816,
    -0.00070545595,
    -0.0049505066,
    -0.026458997,
    0.0035026504,
    0.012891724,
    0.0019562768,
    -0.005446613,
    -0.02002721,
    0.004517733,
    0.004894211,
    -0.004676065,
    0.013919122,
    -0.0053023547,
    -0.0029871927,
    -0.0030593215,
    0.019773878,
    -0.02113905,
    -0.013954306,
    0.020899793,
    0.010710265,
    -0.012265434,
    -0.04849878,
    -0.011688403,
    0.002858768,
    0.022349408,
    0.03158191,
    -0.010773597,
    0.013004315,
    0.0022236817,
    -0.0047605084,
    -0.024559015,
    -0.015115405,
    0.017578345,
    -0.020224243,
    -0.036254454,
    0.022757553,
    0.015945768,
    -0.011969881,
    0.008915838,
    0.0058512385,
    0.047851376,
    -0.013665791,
    -0.013708012,
    -0.021519046,
    -0.021631638,
    -0.020942014,
    -0.01849315,
    0.02529086,
    0.00016250997,
    0.014622818,
    0.015805028,
    0.016747981,
    0.013349127,
    -0.020350909,
    0.00020484172,
    0.022630887,
    0.00631216,
    -0.0066534528,
    -0.013116907,
    0.034424845,
    0.009457684,
    0.00094735174,
    0.00083476026,
    0.02385532,
    -0.0028851565,
    -0.006189013,
    0.00021462751,
    0.01816945,
    0.017296866,
    0.00795881,
    0.0152139235,
    0.00020473177,
    0.013454681,
    -0.0013598939,
    0.031384874,
    0.004151811,
    -0.010886189,
    -0.019239068,
    0.02299681,
    0.0027866391,
    0.007578814,
    -0.0042081065,
    -0.022293113,
    -0.037718143,
    -0.029470818,
    -0.0017873897,
    -0.0030083035,
    -0.009915086,
    -0.016832426,
    -0.015115405,
    0.0026230295,
    -0.01053434,
    -0.00749437,
    -0.011948771,
    -0.010217677,
    -0.012750985,
    -0.012976168,
    0.039181832,
    0.030821918,
    0.0017082238,
    0.01974573,
    -0.0016554466,
    -0.006343826,
    -0.0061080875,
    0.0016695205,
    -0.031413022,
    0.03383374,
    -0.016142802,
    -0.007677331,
    0.011413961,
    0.016339839,
    -0.0065373424,
    -0.012891724,
    0.014411709,
    -0.0127158,
    0.0035431131,
    0.002758491,
    0.0050842087,
    0.005246059,
    0.028753048,
    0.020083504,
    0.0092325015,
    -0.0069454866,
    -0.006452899,
    0.014095046,
    -0.019098328,
    0.011800994,
    0.007677331,
    -0.0012332285,
    -0.0024488645,
    0.017198348,
    -0.023404954,
    -0.009760274,
    0.006512713,
    -0.0032475605,
    -0.013989491,
    0.0119135855,
    -0.014102083,
    0.038112216,
    -0.003580057,
    0.022025708,
    0.012209138,
    -0.027162693,
    0.0006988588,
    -0.0130465375,
    -0.029949334,
    0.010499155,
    -0.016241321,
    -0.0068645617,
    0.030990804,
    -0.013116907,
    -0.0011549422,
    -0.0076562203,
    0.019858321,
    0.011575812,
    0.011596922,
    0.011871364,
    -0.016649464,
    -0.016030211,
    -0.018436855,
    0.009119909,
    0.0066675264,
    -0.000112481524,
    -0.01670576,
    -0.022236817,
    -0.010147307,
    -0.02668418,
    -0.039294425,
    -0.00067510904,
    -0.018141301,
    -0.041011445,
    0.018577594,
    0.022293113,
    0.017817602,
    -0.011674329,
    0.012877651,
    -0.009788422,
    -0.017986488,
    -0.017057609,
    -0.011533589,
    -0.011758773,
    0.014334302,
    0.058885343,
    0.006554935,
    0.00617142,
    -0.007916588,
    0.030174516,
    0.029639706,
    0.0012050807,
    -0.03372115,
    0.010717302,
    -0.009338056,
    -0.012497654,
    -0.010815819,
    0.0054501314,
    0.001011564,
    -0.005217911,
    0.011491368,
    -0.013229499,
    0.009795458,
    -0.0094858315,
    -0.019717582,
    -0.024333833,
    -0.06293864,
    -0.014693188,
    -0.015143554,
    -0.0072058546,
    -0.0058899415,
    -0.035325576,
    -0.0012050807,
    -0.002473494,
    0.006533824,
    0.020477574,
    0.00109073,
    0.04255958,
    -0.03011822,
    0.022841996,
    0.006393085,
    0.007346594,
    0.018929442,
    -0.017831676,
    0.0063790106,
    0.008951022,
    0.010646932,
    0.019407956,
    0.004274958,
    0.010245824,
    0.0005717536,
    -0.0029009897,
    0.04664102,
    -0.0076914052,
    -0.008008068,
    -0.014228748,
    -0.0310471,
    -0.019576844,
    -0.03146932,
    -0.036901858,
    -0.016550947,
    0.016733909,
    0.007124929,
    -0.0053656874,
    0.004880137,
    -0.023742728,
    -0.020083504,
    -0.014524301,
    0.0100980485,
    0.02396791,
    0.019365733,
    0.029555263,
    0.030850064,
    -0.00081408914,
    -0.030315256,
    -0.0036416305,
    0.003926628,
    -0.00475699,
    0.020364983,
    0.025699005,
    0.0022166446,
    -0.021955337,
    0.029498966,
    0.0061432724,
    -0.0039477386,
    -0.007360668,
    0.01831019,
    -0.011456183,
    -0.002278218,
    -0.009014355,
    -0.014538375,
    -0.027641207,
    0.00071161333,
    0.004669028,
    -0.0018876665,
    0.00075427495,
    0.008775098,
    -0.009851755,
    -0.009915086,
    -0.005369206,
    0.013883936,
    -0.0038386656,
    -0.011526552,
    0.000008253318,
    0.004894211,
    -0.041152183,
    -0.018718332,
    -0.018408706,
    0.0168465,
    -0.01232173,
    -0.007944736,
    -0.011660255,
    0.022827921,
    -0.005404391,
    -0.0031472836,
    -0.00012919432,
    0.025487896,
    0.0053551323,
    0.010907299,
    -0.005668277,
    -0.030681178,
    0.017339088,
    -0.017578345,
    -0.009809532,
    0.008373991,
    -0.016902795,
    -0.014890223,
    0.027570838,
    -0.012821354,
    -0.0022887737,
    -0.007005301,
    -0.009535091,
    -0.03079377,
    -0.013377274,
    -0.028710827,
    0.01849315,
    -0.023601988,
    0.005478279,
    0.009028429,
    -0.020167949,
    0.028133795,
    0.010365453,
    0.023616062,
    -0.002735621,
    0.01649465,
    -0.03738037,
    -0.016508725,
    0.007202336,
    0.017268717,
    -0.02471383,
    0.0016229006,
    -0.0046443986,
    -0.0174939,
    0.018999811,
    0.014383561,
    -0.030850064,
    -0.005471242,
    0.048414335,
    0.0005761517,
    0.0035765385,
    -0.01264543,
    0.020829422,
    0.034227807,
    0.0027549728,
    -0.009366203,
    -0.009549164,
    0.029442672,
    0.0076562203,
    -0.012617283,
    0.01856352,
    -0.015256145,
    -0.003645149,
    -0.010583599,
    0.010731375,
    0.022546444,
    0.0026564552,
    -0.02468568,
    0.020899793,
    0.0024330313,
    -0.024460498,
    -0.0021497936,
    0.011751736,
    -0.019267216,
    -0.011146557,
    0.031159692,
    -0.00095526833,
    -0.016691687,
    -0.0062980857,
    -0.002589604,
    0.016579095,
    0.016522799,
    -0.016959092,
    -0.03805592,
    -0.04306624,
    -0.050412834,
    -0.034790765,
    -0.014749483,
    -0.01573466,
    0.023081252,
    -0.009190279,
    -0.036282603,
    -0.019084256,
    -0.03287671,
    -0.012335803,
    -0.0013634124,
    -0.016607244,
    0.015284293,
    0.022841996,
    0.0363389,
    -0.0094013885,
    0.005063098,
    -0.0049892096,
    0.02600863,
    -0.0049856915,
    -0.00011830901,
    0.008092512,
    -0.017648714,
    -0.005077172,
    -0.0009834162,
    -0.028809344,
    -0.011132482,
    0.010147307,
    0.011969881,
    0.01327172,
    0.021645712,
    -0.03405892,
    -0.005668277,
    0.002705714,
    -0.011709513,
    -0.023489397,
    0.0017715566,
    0.008782135,
    -0.030005628,
    -0.009394351,
    -0.014468005,
    0.0069454866,
    -0.013567273,
    -0.02529086,
    0.024221241,
    -0.023545692,
    -0.005647166,
    -0.0015006333,
    0.010991743,
    -0.018816851,
    -0.01116063,
    0.026276035,
    0.0060271625,
    -0.020759054,
    0.011610996,
    -0.011674329,
    -0.014137267,
    -0.008402139,
    0.016677612,
    -0.018000562,
    -0.01874648,
    0.006829377,
    -0.017831676,
    0.021800525,
    -0.004904766,
    0.021448676,
    -0.004352364,
    -0.035747793,
    -0.03645149,
    0.0137361605,
    -0.016579095,
    -0.021082753,
    0.0002399166,
    -0.029893037,
    -0.021814598,
    -0.009070651,
    -0.022644961,
    -0.0045353253,
    -0.006104569,
    -0.019773878,
    -0.015340589,
    -0.01835241,
    0.0003412929,
    -0.021350158,
    -0.037436664,
    0.011660255,
    0.019619064,
    0.013919122,
    0.038168512,
    0.19027959,
    -0.0035536685,
    0.00039253084,
    0.012385063,
    0.009338056,
    -0.007188262,
    0.02146275,
    0.0062382715,
    -0.015903546,
    0.015326515,
    0.015396885,
    0.012976168,
    -0.00756474,
    0.001800584,
    -0.004911803,
    0.00038901233,
    -0.032567084,
    0.017733157,
    -0.05469131,
    -0.030934509,
    0.007740664,
    0.0012305897,
    0.003106821,
    -0.012940983,
    0.026501218,
    -0.010196566,
    0.01505911,
    -0.0014839205,
    -0.010949521,
    0.018901294,
    -0.024263464,
    0.0064775283,
    0.013665791,
    0.009408426,
    -0.017944267,
    -0.0057843872,
    0.023264214,
    -0.0048414334,
    0.05204541,
    0.0191687,
    0.008183993,
    -0.031159692,
    0.018465003,
    0.0042819944,
    0.00018241139,
    -0.0204635,
    -0.017550196,
    -0.0041588475,
    0.02127979,
    0.008521767,
    -0.010843966,
    0.021167198,
    0.016156876,
    -0.0014232267,
    0.003265153,
    -0.0025737707,
    0.0128706135,
    -0.018338338,
    0.0049188402,
    0.010942484,
    -0.0019545176,
    0.021350158,
    -0.036367048,
    0.016002063,
    0.00756474,
    0.0227857,
    -0.026853068,
    -0.023700505,
    0.03355226,
    0.0030399698,
    0.013961343,
    -0.005798461,
    0.013926159,
    0.0120895095,
    -0.024347907,
    -0.010463971,
    0.018296115,
    -0.009070651,
    0.017043535,
    0.0227857,
    -0.012997279,
    -0.021153124,
    -0.0055099456,
    -0.01505911,
    -0.002234237,
    -0.01436245,
    0.017198348,
    -0.005946237,
    -0.023911614,
    0.0014979944,
    0.0013502181,
    0.00006828058,
    -0.010569525,
    -0.013862826,
    -0.0028552494,
    -0.0110480385,
    0.01946425,
    0.0148620745,
    0.001134711,
    -0.017296866,
    -0.010520266,
    0.060292736,
    0.0039653312,
    0.008036217,
    -0.033974476,
    0.007515481,
    0.020942014,
    0.004369957,
    -0.019590916,
    0.0024559016,
    0.0031455243,
    -0.042953648,
    0.012497654,
    -0.007311409,
    -0.003986442,
    0.044924,
    -0.017395383,
    -0.02515012,
    -0.010288046,
    -0.019858321,
    -0.0017583622,
    -0.04081441,
    -0.010900263,
    0.0015446143,
    0.0027479357,
    0.0027778428,
    0.008183993,
    -0.028035278,
    -0.028992305,
    -0.029386375,
    0.012793207,
    0.018127227,
    0.016072433,
    -0.008134734,
    -0.030765621,
    -0.01106915,
    -0.00788844,
    -0.0135602355,
    0.011990992,
    0.034537435,
    -0.0076562203,
    -0.004693657,
    0.022039782,
    0.0059919776,
    0.0057667946,
    -0.03687371,
    0.022335334,
    -0.008148808,
    -0.020801276,
    -0.04728842,
    -0.020364983,
    -0.028499717,
    -0.0031683946,
    -0.0007916588,
    0.029555263,
    0.015579846,
    0.01649465,
    -0.038140364,
    -0.00075823325,
    0.0019527584,
    -0.05626759,
    -0.0026740476,
    0.01960499,
    0.012145805,
    -0.008437323,
    -0.0062171607,
    -0.1810471,
    0.011371739,
    0.0053551323,
    -0.02410865,
    -0.011238037,
    0.00582309,
    0.018436855,
    -0.0025561783,
    -0.013778382,
    0.007325483,
    0.024770126,
    0.0040603303,
    -0.023053104,
    0.00001884313,
    -0.016241321,
    -0.0022219224,
    -0.006759007,
    0.032144867,
    0.012603208,
    0.019393882,
    0.0050138393,
    -0.020196097,
    -0.0023169215,
    0.0053938353,
    -0.008289548,
    -0.0030153405,
    -0.039435163,
    0.016902795,
    -0.010048789,
    0.008571026,
    -0.039913677,
    0.0174939,
    0.033355225,
    0.0032915415,
    -0.00083036214,
    -0.0011760532,
    0.005953274,
    0.017268717,
    0.01774723,
    0.029386375,
    0.02933008,
    0.016522799,
    0.003324967,
    0.02847157,
    -0.02554419,
    0.013954306,
    0.015410959,
    0.013489867,
    0.014482079,
    -0.00257553,
    -0.003034692,
    -0.018929442,
    -0.0091410205,
    -0.002990711,
    -0.01870426,
    0.042081065,
    0.013834678,
    0.015889471,
    -0.0077054794,
    -0.006882154,
    0.0072621503,
    -0.03130043,
    -0.004352364,
    -0.0036768154,
    -0.0000925801,
    -0.005819572,
    -0.020773128,
    -0.0038351472,
    -0.027993055,
    -0.008507693,
    0.0059743854,
    -0.011350628,
    0.0060904953,
    0.01888722,
    -0.008176956,
    0.009021392,
    -0.027584912,
    0.026346406,
    -0.0036345937,
    0.018619815,
    -0.00025904836,
    0.06333271,
    -0.01598799,
    0.017043535,
    0.002132201,
    0.006276975,
    0.020843497,
    0.0026019188,
    -0.008641396,
    -0.0036768154,
    0.002125164,
    -0.0021955338,
    0.023770876,
    -0.03512854,
    0.010006567,
    0.003933665,
    -0.01318024,
    0.034706324,
    0.009408426,
    0.006104569,
    -0.015805028,
    0.0009376759,
    -0.0356915,
    0.03372115,
    0.0066956743,
    -0.0085358415,
    -0.04199662,
    0.011885438,
    0.04264402,
    -0.008345843,
    -0.0310471,
    0.021181272,
    0.029217489,
    0.048977293,
    -0.013025426,
    0.026993807,
    0.009295834,
    -0.02106868,
    -0.007719553,
    0.008205104,
    0.019914618,
    -0.02918934,
    0.008155845,
    0.019942766,
    -0.022813847,
    -0.007012338,
    -0.08900356,
    -0.02768343,
    -0.001055545,
    -0.01310987,
    -0.004591621,
    0.015227997,
    -0.0006909422,
    -0.0015393366,
    -0.012532839,
    0.0067167855,
    -0.00072568725,
    -0.006713267,
    -0.009718052,
    -0.0031367282,
    0.023925688,
    -0.009415463,
    -0.0067343777,
    -0.012420247,
    0.0134757925,
    0.029020453,
    -0.024347907,
    -0.01491837,
    0.004151811,
    0.004250328,
    0.010238787,
    -0.016607244,
    -0.018507224,
    -0.002299329,
    0.0254316,
    -0.009901013,
    0.026712328,
    -0.011674329,
    0.010513229,
    -0.0042819944,
    -0.025487896,
    -0.0015973916,
    -0.035381872,
    -0.014538375,
    0.011371739,
    -0.01756427,
    0.011111371,
    -0.00967583,
    0.0060623474,
    -0.019182773,
    -0.021561267,
    -0.0060130884,
    -0.012047288,
    0.04678176,
    0.00038307492,
    -0.022264965,
    -0.032595232,
    0.0049082846,
    -0.011885438,
    -0.0012490617,
    0.005323466,
    -0.0009121669,
    0.017339088,
    0.02317977,
    -0.02550197,
    -0.045768436,
    0.0065443795,
    0.025121974,
    -0.026698254,
    -0.006970116,
    -0.0017152608,
    0.015607993,
    -0.021209419,
    -0.039435163,
    0.024995308,
    0.016044285,
    -0.018113153,
    -0.015664289,
    -0.017282791,
    0.003055803,
    -0.013419497,
    -0.035072245,
    -0.008212141,
    0.0056929067,
    0.014186526,
    -0.018774629,
    0.010717302,
    -0.0121739535,
    -0.011012854,
    0.004939951,
    0.03524113,
    0.012863576,
    -0.009929161,
    -0.020829422,
    0.017254643,
    -0.02081535,
    -0.0039371834,
    0.002002017,
    0.021012384,
    -0.0035466314,
    -0.04731657,
    0.0053093918,
    0.004134218,
    0.0042608837,
    0.0066745635,
    0.0011804512,
    -0.0508632,
    0.018985737,
    -0.07588665,
    0.034706324,
    -0.0009772588,
    0.012209138,
    -0.005981422,
    -0.017972415,
    0.019084256,
    -0.037295926,
    -0.008507693,
    0.035747793,
    0.005858275,
    0.02317977,
    0.0052566146,
    0.021941263,
    0.003375985,
    -0.0054747607,
    0.02933008,
    -0.009126946,
    0.021251641,
    -0.0054747607,
    -0.017212423,
    0.0016193821,
    -0.017592419,
    0.025924187,
    -0.032538936,
    0.038252953,
    -0.01649465,
    0.013489867,
    -0.02146275,
    -0.0074380743,
    0.017690936,
    -0.01870426,
    0.010400638,
    0.04596547,
    -0.025867892,
    -0.033890035,
    -0.0035589463,
    0.009112872,
    0.03659223,
    0.0078462185,
    -0.02085757,
    -0.03158191,
    -0.022011634,
    -0.022799773,
    0.0021339604,
    0.030427847,
    -0.013081722,
    0.019224994,
    0.029696003,
    -0.0023239586,
    0.0074802963,
    0.020505723,
    -0.008986208,
    -0.03805592,
    0.003106821,
    -0.0062523456,
    0.001510309,
    0.018338338,
    -0.0130395,
    -0.007860293,
    0.028105648,
    -0.010914336,
    0.03662038,
    0.003761259,
    -0.0006940209,
    0.007248076,
    -0.0098376805,
    0.006276975,
    0.008845468,
    -0.01670576,
    -0.009239538,
    -0.0204635,
    -0.0051369863,
    0.012363952,
    0.021490898,
    0.01849315,
    -0.0078039966,
    -0.0042890315,
    -0.007248076,
    0.02707825,
    0.020364983,
    -0.010527303,
    -0.017873896,
    -0.029133044,
    -0.008676581,
    0.009760274,
    -0.016987238,
    0.009091762,
    0.0060130884,
    0.0040005157,
    -0.038224805,
    0.009549164,
    -0.009063614,
    -0.013757271,
    0.0066253045,
    -0.0092325015,
    0.022447925,
    -0.003034692,
    0.027345655,
    0.028035278,
    0.0021832192,
    0.017409457,
    0.0057140174,
    -0.03051229,
    -0.019548696,
    0.00063684554,
    -0.021054607,
    -0.022405704,
    0.012258397,
    -0.014453931,
    -0.019365733,
    0.019717582,
    -0.01842278,
    0.027050102,
    -0.011322481,
    0.004591621,
    0.021842746,
    -0.011618033,
    -0.031328578,
    0.021631638,
    0.011998029,
    -0.014137267,
    -0.011076187,
    -0.03802777,
    0.032820415,
    0.0035976495,
    0.00021770617,
    -0.0078110336,
    0.038984798,
    -0.0072199283,
    0.0227857,
    -0.007972884,
    -0.001979147,
    0.0018507224,
    -0.017254643,
    -0.004415697,
    0.009338056,
    0.021181272,
    0.0044860668,
    0.08168512,
    0.0058688307,
    -0.016719835,
    -0.0049153217,
    0.007944736,
    0.029808594,
    0.002881638,
    0.01835241,
    0.01988647,
    -0.019492399,
    0.031244135,
    -0.011983955,
    0.040223304,
    -0.0032070978,
    -0.0010740171,
    -0.008381028,
    0.013510977,
    0.030596733,
    -0.008718803,
    -0.017395383,
    0.027838243,
    0.010337305,
    0.018042784,
    -0.024882717,
    -0.024418276,
    0.0051018014,
    0.0349878,
    -0.025881967,
    -0.0095773125,
    -0.05877275,
    0.01164618,
    0.021589415,
    -0.018338338,
    -0.022898292,
    0.0043910677,
    -0.006160865,
    0.004897729,
    -0.00046663888,
    0.019830173,
    -0.005552167,
    0.0063579,
    0.040870707,
    -0.022729404,
    -0.029724149,
    0.041771438,
    -0.021490898,
    -0.01731094,
    0.00033007775,
    -0.021223493
  ];
  await search(client, queryVector);
}
async function main() {
  const client = await initConnection();
  // await performHardcodedSearch(client);

  const credential =
    new ClientSecretCredential(process.env.AZURE_TENANT_ID,
      process.env.AZURE_CLIENT_ID,
      process.env.AZURE_CLIENT_SECRET,
      {
        authorityHost: process.env.AZURE_AUTHORITY_HOST
      }
    );
  const scope = 'https://cognitiveservices.azure.com/.default';
  const azureADTokenProvider = getBearerTokenProvider(credential, scope);

  const embeddings = new AzureOpenAIEmbeddings({
    azureADTokenProvider,
    azureOpenAIApiInstanceName: process.env.AZURE_OPENAI_API_INSTANCE_NAME,
    // azureOpenAIApiDeploymentName: 'text-embedding-ada-002-blue',
    azureOpenAIApiEmbeddingsDeploymentName: 'text-embedding-ada-002-blue',
    azureOpenAIApiVersion: process.env.AZURE_OPENAI_API_VERSION,
    // chunkSize: 16
  });


  const query = 'What is the payload-id for the sage-id 67ac182f-701e-4191-bef3-33a2c727efb?';
  const queryVector = await embeddings.embedQuery(query);
  console.log(queryVector);
  await search(client, queryVector)
}

main().catch((err) => {
  console.error('The sample encountered an error:', err);
});

module.exports = { main };